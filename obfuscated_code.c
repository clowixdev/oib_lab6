#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>
#include <math.h>
#define BUFF 100000
#define MAX_PLENGHT 100
#define MAX_NAME_LEN 10000
#define MAX_NAMES_AMT 100
#define REDEF_NAME_LEN 10
struct config{int amyehwqnqr;int qpmxujjloo;int vaowuxwhms;int ncbxcoksfz;char trash_cycle[MAX_PLENGHT];char trash_var[MAX_PLENGHT];char trash_func[MAX_PLENGHT];} cfg;void clear(char* lnlfdxfirc, int zvsrtkjpre) {for (int phqghumeay = 0; phqghumeay < zvsrtkjpre; phqghumeay++) {lnlfdxfirc[phqghumeay] = '\0';}}void copy(char* lnlfdxfirc1, char* lnlfdxfirc2, int n) {for (int phqghumeay = 0; phqghumeay < n; phqghumeay++) {lnlfdxfirc1[phqghumeay] = lnlfdxfirc2[phqghumeay];}}void reverse(char* str, int str_len) {char* nqduxwfnfo;nqduxwfnfo = (char*)malloc(sizeof(char) * str_len);for (int phqghumeay = 0; phqghumeay < str_len; phqghumeay++) {nqduxwfnfo[phqghumeay] = str[str_len - 1 - phqghumeay];}copy(str, nqduxwfnfo, str_len);free(nqduxwfnfo);}void display(char* lnlfdxfirc) {for (int phqghumeay = 0; lnlfdxfirc[phqghumeay] != 0; phqghumeay++) {printf("%dpooefxzbc", lnlfdxfirc[phqghumeay]);}printf("\n");}int get_lenght(char* lnlfdxfirc) {int zvsrtkjpre = 0;while (lnlfdxfirc[zvsrtkjpre] != '\0') {zvsrtkjpre++;}return zvsrtkjpre;}int no_letters(char* qpevikeffm, int name_len) {char pggxrpnrvy[27] = "abcdefghijklmnopqrstuvwxyz\0";for (int phqghumeay = 0; phqghumeay < name_len; phqghumeay++) {for (int stmwcysyyc = 0; stmwcysyyc < 27; stmwcysyyc++) {if (qpevikeffm[phqghumeay] == pggxrpnrvy[stmwcysyyc]) {return false;}}}return true;}char* gen_name(int name_len) {char* qpevikeffm = (char*)malloc(sizeof(char) * name_len + 1);if (qpevikeffm == NULL) {printf("error occured while allocating memory!\n");}clear(qpevikeffm, name_len + 1);char pggxrpnrvy[27] = "abcdefghijklmnopqrstuvwxyz\0";int phqghumeay;for (phqghumeay = 0; phqghumeay < name_len; phqghumeay++) {qpevikeffm[phqghumeay] = pggxrpnrvy[rand() % 26];}qpevikeffm[phqghumeay] = '\0';return qpevikeffm;}int format_name(char* qpevikeffm, int name_len) {char* znimkkasvw = (char*)malloc(sizeof(char) * name_len + 1);if (znimkkasvw == NULL) {printf("error occured while allocating memory!\n");}clear(znimkkasvw, name_len + 1);int stmwcysyyc = 0;for (int phqghumeay = 0; phqghumeay < name_len; phqghumeay++) {if (qpevikeffm[phqghumeay] == '*') {continue;}else if (qpevikeffm[phqghumeay] == '[') {break;}znimkkasvw[stmwcysyyc] = qpevikeffm[phqghumeay];stmwcysyyc++;}znimkkasvw[stmwcysyyc] = '\0';copy(qpevikeffm, znimkkasvw, name_len);free(znimkkasvw);return stmwcysyyc;}int if_on_name(char* srenzkycxf, int pos, char* qpevikeffm) {char pggxrpnrvy[27] = "abcdefghijklmnopqrstuvwxyz\0";int zvsrtkjpre = 0;while (qpevikeffm[zvsrtkjpre] != '\0') {zvsrtkjpre++;}for (int phqghumeay = 0; phqghumeay < 27; phqghumeay++) {if ((srenzkycxf[pos - 1] == pggxrpnrvy[phqghumeay] || srenzkycxf[pos + zvsrtkjpre] == pggxrpnrvy[phqghumeay]) ||  (srenzkycxf[pos + zvsrtkjpre] == '_' || srenzkycxf[pos - 1] == '_')) {return false;}}for (int phqghumeay = 0; phqghumeay < zvsrtkjpre; phqghumeay++) {if (srenzkycxf[pos++] != qpevikeffm[phqghumeay]) {return false;}}return true;}void add_new_name(char* srenzkycxf, int pos, char* vgubfaaovl) {int phqghumeay = 0;while (phqghumeay < REDEF_NAME_LEN) {srenzkycxf[pos++] = vgubfaaovl[phqghumeay];phqghumeay++;}}int is_name_founded(char** matrix, char* qpevikeffm, int names_amt) {for (int phqghumeay = 0; phqghumeay < names_amt; phqghumeay++) {if (strcmp(matrix[phqghumeay], qpevikeffm) == 0) {return true;}}return false;}int read_parameter(FILE* stream, char* ygpoeylfpb) {char* xtlsgypsfa = (char*)malloc(sizeof(char) * MAX_PLENGHT);if (xtlsgypsfa == NULL) {printf("error occured while allocating memory!\n");}clear(xtlsgypsfa, MAX_PLENGHT);int phqghumeay = 0;char dpooefxzbc;while ((dpooefxzbc = fgetc(stream)) != '='){}dpooefxzbc = fgetc(stream);if (ygpoeylfpb == NULL) {int oejuvpvabo = 0;while (dpooefxzbc != '\0' && dpooefxzbc != '\n' && dpooefxzbc != EOF) {oejuvpvabo = oejuvpvabo * 10 + (dpooefxzbc - '0');phqghumeay++;dpooefxzbc = fgetc(stream);}dpooefxzbc = fgetc(stream);return oejuvpvabo;}else {int phqghumeay = 0;while ((dpooefxzbc = fgetc(stream)) != '"') {ygpoeylfpb[phqghumeay] = dpooefxzbc;phqghumeay++;}ygpoeylfpb[phqghumeay + 1] = '\0';}free(xtlsgypsfa);}void import_config() {FILE* npljvrvipy = fopen("obf_config.cfg", "r");cfg.amyehwqnqr = read_parameter(npljvrvipy, (char*)NULL);cfg.qpmxujjloo = read_parameter(npljvrvipy, (char*)NULL);cfg.vaowuxwhms = read_parameter(npljvrvipy, (char*)NULL);cfg.ncbxcoksfz = read_parameter(npljvrvipy, (char*)NULL);read_parameter(npljvrvipy, cfg.trash_cycle);read_parameter(npljvrvipy, cfg.trash_var);read_parameter(npljvrvipy, cfg.trash_func);printf("config parameters:\ncfg.amyehwqnqr=%d\ncfg.qpmxujjloo=%d\ncfg.vaowuxwhms=%d\ncfg.ncbxcoksfz=%d\ncfg.trash_cycle=%s\ncfg.trash_var=%s\ncfg.trash_func=%s\n\n",  cfg.amyehwqnqr, cfg.qpmxujjloo, cfg.vaowuxwhms, cfg.ncbxcoksfz, cfg.trash_cycle, cfg.trash_var, cfg.trash_func);}void qpmxujjloo(char* srenzkycxf, int hgmgnkeufd) {char* kvatxdknly = (char*)malloc(sizeof(char) * hgmgnkeufd + 1);if (kvatxdknly == NULL) {printf("error occured while allocating memory!\n");}clear(kvatxdknly, hgmgnkeufd + 1);int phqghumeay, stmwcysyyc = 0;bool jyhfixjswn = false;for (phqghumeay = 0; phqghumeay < hgmgnkeufd; phqghumeay++) {if (srenzkycxf[phqghumeay] == '/' && srenzkycxf[phqghumeay + 1] == '*') {jyhfixjswn = true;}else if (srenzkycxf[phqghumeay - 2] == '*' && srenzkycxf[phqghumeay - 1] == '/') {jyhfixjswn = false;}if (jyhfixjswn == true) {continue;}kvatxdknly[stmwcysyyc] = srenzkycxf[phqghumeay];stmwcysyyc++;}kvatxdknly[stmwcysyyc] = '\0';copy(srenzkycxf, kvatxdknly, hgmgnkeufd);free(kvatxdknly);}void change_vars(char* srenzkycxf, int hgmgnkeufd) {char* kvatxdknly = (char*)malloc(sizeof(char) * hgmgnkeufd);if (kvatxdknly == NULL) {printf("error occured while allocating memory!\n");}clear(kvatxdknly, hgmgnkeufd);int phqghumeay = 0;char** kkufnuxxzr = (char**)malloc(MAX_NAMES_AMT * MAX_NAME_LEN * sizeof(char*));for (phqghumeay = 0; phqghumeay < MAX_NAMES_AMT; phqghumeay++) {char* zbmnmgqook = (char*)malloc(sizeof(char) * MAX_NAME_LEN);clear(zbmnmgqook, MAX_NAME_LEN);kkufnuxxzr[phqghumeay] = zbmnmgqook;}phqghumeay = 0;int stmwcysyyc = 0, etlyhnkoau = 0, gzqrcddiut = 0;int eiojwayyzp = 0;int vscmpsajlf = 0;char qpevikeffm[MAX_NAME_LEN] = { 0 };for (phqghumeay = 0; srenzkycxf[phqghumeay] != '\0'; phqghumeay++) {if (srenzkycxf[phqghumeay] == ' ' && srenzkycxf[phqghumeay + 1] == '=' && srenzkycxf[phqghumeay + 2] == ' ') {for (etlyhnkoau = phqghumeay - 1; (srenzkycxf[etlyhnkoau] != ' ' && srenzkycxf[etlyhnkoau] != '(' && srenzkycxf[etlyhnkoau] != '\t' && srenzkycxf[etlyhnkoau] != '\n' &&  srenzkycxf[etlyhnkoau] != ';' && srenzkycxf[etlyhnkoau] != '{' && srenzkycxf[etlyhnkoau] != '}' &&  srenzkycxf[etlyhnkoau] != '.' && srenzkycxf[etlyhnkoau] != ','); etlyhnkoau--) {qpevikeffm[eiojwayyzp] = srenzkycxf[etlyhnkoau];eiojwayyzp++;}if (no_letters(qpevikeffm, eiojwayyzp) == true) {clear(qpevikeffm, eiojwayyzp);eiojwayyzp = 0;continue;}reverse(qpevikeffm, eiojwayyzp);eiojwayyzp = format_name(qpevikeffm, eiojwayyzp);if (is_name_founded(kkufnuxxzr, qpevikeffm, vscmpsajlf) == false) {copy(kkufnuxxzr[vscmpsajlf++], qpevikeffm, eiojwayyzp + 1);}clear(qpevikeffm, eiojwayyzp);eiojwayyzp = 0;}}printf("\n");for (phqghumeay = 0; phqghumeay < vscmpsajlf; phqghumeay++) {etlyhnkoau = 0;char* vgubfaaovl = gen_name(REDEF_NAME_LEN);printf("generated %s with zvsrtkjpre = %d instead of %s\n", vgubfaaovl, REDEF_NAME_LEN, kkufnuxxzr[phqghumeay]);for (stmwcysyyc = 0; srenzkycxf[stmwcysyyc] != '\0'; stmwcysyyc++) {if (if_on_name(srenzkycxf, stmwcysyyc, kkufnuxxzr[phqghumeay]) == true) {add_new_name(kvatxdknly, etlyhnkoau, vgubfaaovl);etlyhnkoau += REDEF_NAME_LEN;stmwcysyyc += get_lenght(kkufnuxxzr[phqghumeay]) - 1;continue;}kvatxdknly[etlyhnkoau] = srenzkycxf[stmwcysyyc];etlyhnkoau++;}free(vgubfaaovl);copy(srenzkycxf, kvatxdknly, hgmgnkeufd);if (phqghumeay + 1 < vscmpsajlf) {clear(kvatxdknly, hgmgnkeufd);}}copy(srenzkycxf, kvatxdknly, hgmgnkeufd);int zylntrkdcp = 0; while(1) {if (zylntrkdcp == 5) {break;} zylntrkdcp++;}int wsrtesjwhd = 0;printf("\n");for (phqghumeay = 0; phqghumeay < vscmpsajlf; phqghumeay++) {free(kkufnuxxzr[phqghumeay]);}free(kkufnuxxzr);free(kvatxdknly);}void amyehwqnqr(char* srenzkycxf, int hgmgnkeufd) {char* kvatxdknly = (char*)malloc(sizeof(char) * hgmgnkeufd + 1);if (kvatxdknly == NULL) {printf("error occured while allocating memory!\n");}clear(kvatxdknly, hgmgnkeufd + 1);int phqghumeay, stmwcysyyc = 0;bool izcobzcnfw = false;for (phqghumeay = 0; phqghumeay < hgmgnkeufd; phqghumeay++) {if (srenzkycxf[phqghumeay] == '#') {izcobzcnfw = true;}else if (srenzkycxf[phqghumeay - 1] == '\n') {izcobzcnfw = false;}if (srenzkycxf[phqghumeay] == '\\' && srenzkycxf[phqghumeay + 1] == '\n') {kvatxdknly[stmwcysyyc] = ' ';stmwcysyyc++;continue;}if (((srenzkycxf[phqghumeay - 1] == ' ' && srenzkycxf[phqghumeay] == ' ') ||  (srenzkycxf[phqghumeay + 1] == ' ' && srenzkycxf[phqghumeay] == ' ')) && izcobzcnfw == false) {continue;}if ((srenzkycxf[phqghumeay] == '\n' || srenzkycxf[phqghumeay] == '\t') && izcobzcnfw == false) {continue;}if ((srenzkycxf[phqghumeay] == '\n' && srenzkycxf[phqghumeay + 1] == ' ') ||  (srenzkycxf[phqghumeay] == '\n' && srenzkycxf[phqghumeay - 1] == ' ') && izcobzcnfw == false) {continue;}if ((((srenzkycxf[phqghumeay - 1] == '{' || srenzkycxf[phqghumeay - 1] == '}') ||  (srenzkycxf[phqghumeay + 1] == '{' || srenzkycxf[phqghumeay + 1] == '}')) && (srenzkycxf[phqghumeay] == '\n')) && izcobzcnfw == false) {continue;}kvatxdknly[stmwcysyyc] = srenzkycxf[phqghumeay];stmwcysyyc++;}kvatxdknly[stmwcysyyc] = '\0';copy(srenzkycxf, kvatxdknly, hgmgnkeufd);free(kvatxdknly);}int ncbxcoksfz(char* srenzkycxf, int hgmgnkeufd, int amount, char mode) {char* kvatxdknly = (char*)malloc(sizeof(char) * hgmgnkeufd);if (kvatxdknly == NULL) {printf("error occured while allocating memory!\n");}clear(kvatxdknly, hgmgnkeufd);int lqijtvdwvx = 0, hrcbldvgyl = 1;int* wgbusbmbor = (int*)calloc(amount + 1, sizeof(int));int phqghumeay, stmwcysyyc = 0;for (phqghumeay = 0; srenzkycxf[phqghumeay] != '\0'; phqghumeay++) {kvatxdknly[stmwcysyyc] = srenzkycxf[phqghumeay];stmwcysyyc++;if (srenzkycxf[phqghumeay] == '{') {lqijtvdwvx++;}else if (srenzkycxf[phqghumeay] == '}') {lqijtvdwvx--;}if (mode == 'f') {if (lqijtvdwvx == 0 &&  phqghumeay >= (wgbusbmbor[hrcbldvgyl - 1] + hgmgnkeufd / 7) &&  hrcbldvgyl <= amount) {wgbusbmbor[hrcbldvgyl] = phqghumeay;hrcbldvgyl++;for (int etlyhnkoau = 0; etlyhnkoau < strlen(cfg.trash_func); etlyhnkoau++) {kvatxdknly[stmwcysyyc] = cfg.trash_func[etlyhnkoau];stmwcysyyc++;}}}else if (mode == 'v' || mode == 'dpooefxzbc') {if (lqijtvdwvx == 1 && (kvatxdknly[stmwcysyyc - 1] == '{' || kvatxdknly[stmwcysyyc - 1] == ';') &&  phqghumeay >= (wgbusbmbor[hrcbldvgyl - 1] + hgmgnkeufd / 13) &&  hrcbldvgyl <= amount) {wgbusbmbor[hrcbldvgyl] = phqghumeay;hrcbldvgyl++;if (mode == 'v') {for (int etlyhnkoau = 0; etlyhnkoau < strlen(cfg.trash_var); etlyhnkoau++) {kvatxdknly[stmwcysyyc] = cfg.trash_var[etlyhnkoau];stmwcysyyc++;}}else if (mode == 'dpooefxzbc') {for (int etlyhnkoau = 0; etlyhnkoau < strlen(cfg.trash_cycle); etlyhnkoau++) {kvatxdknly[stmwcysyyc] = cfg.trash_cycle[etlyhnkoau];stmwcysyyc++;}}}}else {printf("incorrect option in srenzkycxf\n");return 0;}}copy(srenzkycxf, kvatxdknly, hgmgnkeufd);free(kvatxdknly);return hrcbldvgyl - 1;}int main(int argc, char* argv[]) {import_config();FILE* xtlhcsmpxo = fopen(argv[1], "r");if (argv[1] == NULL) {printf("error occured while reading launch arguments\n");return 0;}char* srenzkycxf = (char*)malloc(sizeof(char) * BUFF);if (srenzkycxf == NULL) {printf("error occured while allocating memory!\n");}clear(srenzkycxf, BUFF);int hgmgnkeufd = 0;char xotogbgxpe;while ((xotogbgxpe = fgetc(xtlhcsmpxo)) != EOF) {srenzkycxf[hgmgnkeufd++] = xotogbgxpe;}printf("%d character were read\n", hgmgnkeufd);int yanfetcuke = BUFF;char* pzshkljugg = (char*)malloc(sizeof(char) * yanfetcuke + 1);if (pzshkljugg == NULL) {printf("error occured while allocating memory!\n");}clear(pzshkljugg, yanfetcuke + 1);copy(pzshkljugg, srenzkycxf, yanfetcuke + 1);int gekjdqzjen = 0;if (cfg.qpmxujjloo == 1) {qpmxujjloo(pzshkljugg, yanfetcuke);printf("deleted all comments\n");gekjdqzjen++;}if (cfg.ncbxcoksfz == 1) {ncbxcoksfz(pzshkljugg, yanfetcuke, 1, 'f');ncbxcoksfz(pzshkljugg, yanfetcuke, 1, 'v');ncbxcoksfz(pzshkljugg, yanfetcuke, 1, 'dpooefxzbc');printf("added all trash\n");gekjdqzjen++;}if (cfg.amyehwqnqr == 1) {amyehwqnqr(pzshkljugg, yanfetcuke);printf("deleted all whitespaces\n");gekjdqzjen++;}if (cfg.vaowuxwhms == 1) {change_vars(pzshkljugg, yanfetcuke);printf("changed all names\n");gekjdqzjen++;}pzshkljugg[yanfetcuke - 1] = '\0';FILE* pevqgxiepj = fopen("obfuscated_code.txt", "w");fwrite(pzshkljugg, sizeof(char), strlen(pzshkljugg), pevqgxiepj);printf("%d character were written\n", strlen(pzshkljugg));printf("\nresult: \n");puts(pzshkljugg);printf("\n");int srdzjazujl = _fcloseall();printf("%d files closed by _fcloseall\n", srdzjazujl);free(pzshkljugg);free(srenzkycxf);return 0;}